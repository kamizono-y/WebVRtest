<script type="module">
  // --- ライブラリの読み込み ---
  import * as THREE from 'three';
  import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
  import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
  import { BoxLineGeometry } from 'three/addons/geometries/BoxLineGeometry.js';
  import { VRButton } from 'three/addons/webxr/VRButton.js';

  // --- シーンとレンダラーの初期設定 ---
  const scene = new THREE.Scene();
  scene.background = null; // ★修正点1: シーンの背景を透過させる

  const renderer = new THREE.WebGLRenderer({
    antialias: true,
    alpha: true // ★修正点2: レンダラーでアルファ（透明度）を有効にする
  });
  document.body.appendChild(renderer.domElement);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.xr.enabled = true;

  // --- カメラとライトの設定 ---
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(0, 1.6, 3);
  const controls = new OrbitControls(camera, renderer.domElement);
  const light = new THREE.DirectionalLight(0xFFFFFF, 1.0);
  light.position.set(1, 1, 1);
  scene.add(light);
  scene.add(new THREE.HemisphereLight(0x808080, 0x606060));

  // --- 3Dモデルの読み込み ---
  const loader = new GLTFLoader();
  const url = './logo20250626.glb';
  let model;
  loader.load(url, (gltf) => {
    model = gltf.scene;
    model.position.set(0, 1, -3);
    scene.add(model);
  });

  // --- VR空間の部屋（パススルーではあまり見えないが、位置の基準として有用） ---
  const room = new THREE.LineSegments(
    new BoxLineGeometry(8, 5, 8, 10, 10, 10).translate(0, 2.5, 0),
    new THREE.LineBasicMaterial({ color: 0x808080 })
  );
  scene.add(room);

  // --- VRボタンの追加 ---
  document.body.appendChild(VRButton.createButton(renderer));

  // --- アニメーションループ ---
  function tick() {
    if (model) {
      model.rotation.y += 0.005;
    }
    controls.update();
    renderer.render(scene, camera);
  }
  renderer.setAnimationLoop(tick);
</script>